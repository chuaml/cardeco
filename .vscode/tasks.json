{
    // See https://go.microsoft.com/fwlink/?LinkId=733558
    // for the documentation about the tasks.json format
    "version": "2.0.0",
    "tasks": [
        {
            "label": "php run current script file",
            "type": "shell",
            "command": "php -d xdebug.log=\"CON\" -d xdebug.log_level=3 -d xdebug.mode=develop,debug,trace,profile  -d xdebug.show_local_vars=1 -d xdebug.start_with_request=yes \"${file}\""
        },
         {
            "label": "composer dumpautoload", 
            "type": "shell",
            "command": "composer dumpautoload",
         },


        {
            "label": "start development container",
            "type": "shell",
            "command": "docker compose down && docker compose --profile dev up"
        },


        {
           "label": "build staging image",
           "type": "shell",
           "command": "docker build --target production_app -t cardeco:staging ."
        },
        {
            "label": "redeploy the staging stack",
            "type": "shell",
            "command": "docker stack rm cardeco_staging && docker stack deploy --compose-file=compose.staging.yml cardeco_staging --detach=false"
        },



        {
            "label": "build production image",
            "type": "shell",
            "command": "docker build --target production_app -t cardeco:production ."
        },
        {
            "label": "redeploy the production stack",
            "type": "shell",
            "command": "docker stack rm cardeco_production && docker stack deploy --compose-file=compose.production.yml cardeco_production --detach=false"
        },


        {
            "label": "tear down all stacks, stop and remove all deployed apps",
            "type": "shell",
            "command": "for /f \"tokens=*\" %i in ('docker stack ls --format \"{{.Name}}\"') do docker stack rm %i  &&  docker compose down"
        },
    ]
}